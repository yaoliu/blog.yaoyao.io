import{_ as s,b as n}from"./app.f8faba05.js";const a={},e=n(`<p>2022-01-19\u65E5\u66F4\u65B0</p><ol><li>\u5F88\u591A\u4EBA\u7528 M1 \u67B6\u6784\u7F16\u8BD1\u90FD\u51FA\u73B0\u4E86\u9519\u8BEF \u7136\u540E\u6211\u540C\u6837\u590D\u73B0\u4E86\u9519\u8BEF\u5E76\u4E14\u627E\u5230\u4E86\u89E3\u51B3\u529E\u6CD5</li><li>\u66F4\u8BE6\u7EC6\u7684\u63CF\u8FF0\u4E86\u4E0D\u540C\u7684\u5B89\u88C5\u8FC7\u7A0B</li></ol><p>\u672C\u7BC7\u6587\u7AE0\u4E3B\u8981\u8BB0\u5F55\u4E00\u4E0B\u5B66\u4E60MIT6.S081\u8BFE\u7A0B\u90E8\u7F72\u5B9E\u9A8C\u73AF\u5883\u7684\u8BE6\u7EC6\u8FC7\u7A0B\u3002</p><p>\u8BFE\u7A0B\u94FE\u63A5\uFF1A<a href="https://pdos.csail.mit.edu/6.S081/2020/" target="_blank" rel="noopener noreferrer">https://pdos.csail.mit.edu/6.S081/2020/</a></p><h2 id="\u6211\u7684\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#\u6211\u7684\u73AF\u5883" aria-hidden="true">#</a> \u6211\u7684\u73AF\u5883\uFF1A</h2><p>\u7535\u8111\u578B\u53F7\uFF1AMacBook Pro (14-inch, 2021)</p><p>\u7CFB\u7EDF\u7248\u672C\uFF1AmacOS Monterey 12.1</p><p>\u6211\u7684\u7B14\u8BB0\u672C\u662F arm64(M1\u82AF\u7247) \u67B6\u6784\u7684\uFF0C\u4F46\u6B64\u7BC7\u6587\u7AE0\u9002\u7528\u4E8E M1 \u53CA Intel\u3002</p><h2 id="\u524D\u63D0-\u5FC5\u987B\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u524D\u63D0-\u5FC5\u987B\u5B89\u88C5" aria-hidden="true">#</a> \u524D\u63D0(\u5FC5\u987B\u5B89\u88C5)\uFF1A</h2><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u9700\u8981\u5B89\u88C5 brew \u540E\u9762\u5F88\u591A\u5730\u65B9\u90FD\u9700\u8981\u7528\u5230\u6B64\u5DE5\u5177</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u5B89\u88C5Brew \u5982\u679C\u5DF2\u7ECF\u5B89\u88C5\u4E86\u53EF\u4EE5\u4E0B\u4E00\u6B65</span>
/bin/bash -c <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="token variable">)</span></span>&quot;</span>
<span class="token comment"># \u68C0\u67E5\u662F\u5426\u5B89\u88C5\u6210\u529F</span>
brew -v
<span class="token comment"># \u6253\u5370\u4EE5\u4E0B\u5185\u5BB9\u4EE3\u8868\u6210\u529F</span>
Homebrew <span class="token number">3.3</span>.11-21-gec389a6
Homebrew/homebrew-core <span class="token punctuation">(</span>git revision 68defcb5dd3<span class="token punctuation">;</span> last commit <span class="token number">2022</span>-01-18<span class="token punctuation">)</span>
Homebrew/homebrew-cask <span class="token punctuation">(</span>git revision c6cfd6f92b<span class="token punctuation">;</span> last commit <span class="token number">2022</span>-01-18<span class="token punctuation">)</span>
<span class="token comment"># \u5B89\u88C5\u57FA\u672C\u4F9D\u8D56\u73AF\u5883</span>
brew <span class="token function">install</span> python3 <span class="token function">gawk</span> gnu-sed gmp mpfr libmpc isl zlib expat gsed
brew tap discoteq/discoteq
brew <span class="token function">install</span> flock
<span class="token comment"># Qemu \u9700\u8981\u4F9D\u8D56ninja</span>
brew <span class="token function">install</span> ninja
</code></pre></div><h3 id="\u5173\u4E8E-gcc-llvm-clang-\u53EF\u9009" tabindex="-1"><a class="header-anchor" href="#\u5173\u4E8E-gcc-llvm-clang-\u53EF\u9009" aria-hidden="true">#</a> \u5173\u4E8E GCC / LLVM + CLANG\uFF08\u53EF\u9009\uFF09</h3><p>Mac \u9ED8\u8BA4\u60C5\u51B5\u4E0B\u9884\u88C5\u7684\u73AF\u5883\u662F LLVM+CLANG \u800C\u4E0D\u662F GCC \u867D\u7136\u6709 GCC \u7684\u547D\u4EE4 \u4F46\u662F\u5176\u5B9E\u662F CLANG</p><p>\u6D4B\u8BD5\u5982\u4E0B \u6267\u884C gcc -v:</p><div class="language-bash ext-sh"><pre class="language-bash"><code>gcc -v
Configured with: --prefix<span class="token operator">=</span>/Library/Developer/CommandLineTools/usr --with-gxx-include-dir<span class="token operator">=</span>/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/4.2.1
Apple clang version <span class="token number">13.0</span>.0 <span class="token punctuation">(</span>clang-1300.0.29.30<span class="token punctuation">)</span>
Target: arm64-apple-darwin21.2.0
Thread model: posix
InstalledDir: /Library/Developer/CommandLineTools/usr/bin
</code></pre></div><p>\u5728\u7F16\u8BD1 <a href="https://github.com/riscv-collab/riscv-gnu-toolchain" target="_blank" rel="noopener noreferrer">riscv-gnu-toolchain</a> \u5DE5\u5177\u94FE\u7684\u65F6\u5019\uFF0C\u672C\u673A\u662F GCC \u8FD8\u662F LLVM+CLANG \u90FD\u4E0D\u4F1A\u5F71\u54CD\uFF0C\u6211\u4EB2\u6D4B\u90FD\u53EF\u4EE5\u7F16\u8BD1\u6210\u529F\uFF0C\u6240\u4EE5\u8FD9\u4E2A\u5730\u65B9\u53EF\u4EE5\u4FDD\u6301\u9ED8\u8BA4\uFF0C\u5982\u679C\u9700\u8981\u5B89\u88C5GCC \u6765\u66FF\u6362 LLVM + CLANG \u53EF\u4EE5\u6309\u7167\u4EE5\u4E0B\u6B65\u9AA4\u64CD\u4F5C:</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u5B89\u88C5</span>
brew <span class="token function">install</span> gcc
<span class="token comment"># \u7248\u672C\u4E3Agcc 11.2.0_3</span>
<span class="token comment"># \u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF: </span>
<span class="token comment"># \u628A\u4EE5\u4E0B\u5185\u5BB9\u6DFB\u52A0\u5230 ~/.zshrc \u6216\u8005 ~/.bash_profile  \u6216\u8005 /etc/profile</span>
<span class="token comment"># \u56E0\u4E3A\u6211\u4F7F\u7528\u7684\u662Fzsh \u6240\u4EE5\u914D\u7F6E\u5230 ~/.zshrc \u91CC</span>
<span class="token function">vim</span> ~/.zshrc
<span class="token comment"># \u589E\u52A0\u4EE5\u4E0B\u5185\u5BB9 </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GCCPATH</span><span class="token operator">=</span>/opt/homebrew/Cellar/gcc/11.2.0_3/
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">\${GCCPATH<span class="token operator">/</span><span class="token operator">/</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>bin<span class="token operator">:</span>}</span>/bin
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">gcc</span><span class="token operator">=</span><span class="token string">&#39;gcc-11&#39;</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">cc</span><span class="token operator">=</span><span class="token string">&#39;gcc-11&#39;</span>
<span class="token builtin class-name">alias</span> g+<span class="token operator">+=</span><span class="token string">&#39;g++-11&#39;</span>
<span class="token builtin class-name">alias</span> c+<span class="token operator">+=</span><span class="token string">&#39;c++-11&#39;</span>
<span class="token comment"># \u4F7F\u73AF\u5883\u751F\u6548</span>
<span class="token builtin class-name">source</span> ~/.zshrc
<span class="token comment"># \u6D4B\u8BD5</span>
gcc -v
Using built-in specs.
<span class="token assign-left variable">COLLECT_GCC</span><span class="token operator">=</span>gcc-11
<span class="token assign-left variable">COLLECT_LTO_WRAPPER</span><span class="token operator">=</span>/opt/homebrew/Cellar/gcc/11.2.0_3/bin/<span class="token punctuation">..</span>/libexec/gcc/aarch64-apple-darwin21/11/lto-wrapper
Target: aarch64-apple-darwin21
<span class="token punctuation">..</span><span class="token punctuation">..</span>\u7701\u7565
Thread model: posix
Supported LTO compression algorithms: zlib zstd
gcc version <span class="token number">11.2</span>.0 <span class="token punctuation">(</span>Homebrew GCC <span class="token number">11.2</span>.0_3<span class="token punctuation">)</span>
</code></pre></div><h2 id="\u5B89\u88C5-riscv-gnu-toolchain" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5-riscv-gnu-toolchain" aria-hidden="true">#</a> \u5B89\u88C5 riscv-gnu-toolchain</h2><p><strong>\u4EE5\u4E0B\u5B89\u88C5\u9009\u4E00\u4E2A\u5373\u53EF \u4F60\u600E\u4E48\u5F00\u5FC3\u600E\u4E48\u9009 \u6211\u7528\u7684\u662F <code>2.\u6E90\u7801\u7F16\u8BD1\u5B89\u88C5</code></strong></p><h3 id="_1-\u4F7F\u7528-brew-\u8FDB\u884C\u5B89\u88C5-\u53EF\u9009" tabindex="-1"><a class="header-anchor" href="#_1-\u4F7F\u7528-brew-\u8FDB\u884C\u5B89\u88C5-\u53EF\u9009" aria-hidden="true">#</a> 1. \u4F7F\u7528 brew \u8FDB\u884C\u5B89\u88C5\uFF08\u53EF\u9009\uFF09</h3><p>\u6211\u7528\u4E86\u8FD9\u4E2A\u6B65\u9AA4\u5B89\u88C5 \u4F1A\u51FA\u73B0\u4E00\u4E9B\u95EE\u9898 \u6240\u4EE5\u6B64\u5904\u9700\u8981\u770B\u8FD0\u6C14\u4E86\u3002</p><div class="language-bash ext-sh"><pre class="language-bash"><code>brew tap riscv-software-src/riscv
brew <span class="token function">install</span> riscv-tools
</code></pre></div><h3 id="_2-\u6E90\u7801\u7F16\u8BD1\u5B89\u88C5-\u53EF\u9009" tabindex="-1"><a class="header-anchor" href="#_2-\u6E90\u7801\u7F16\u8BD1\u5B89\u88C5-\u53EF\u9009" aria-hidden="true">#</a> 2. \u6E90\u7801\u7F16\u8BD1\u5B89\u88C5\uFF08\u53EF\u9009\uFF09</h3><p><strong>\u514B\u9686\u6E90\u7801</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">git</span> clone --recursive https://github.com/riscv/riscv-gnu-toolchain
</code></pre></div><p>\u6211\u5B89\u88C5\u7684\u7248\u672C</p><p>riscv-gnu-toolchain commit: <strong>f640044a947afb39c78b96fa1ba1db8aa31b1d89</strong> tag: <strong>2022.01.17</strong></p><p>qemu commit: <strong>553032db17440f8de011390e5a1cfddd13751b0b</strong> tag: <strong>v5.2.0</strong></p><p>riscv-binutils commit: <strong>116a737f438d03a1bd6aa706b6ea0b4022f3b7e2(riscv-binutils-2.37)</strong></p><p>riscv-dejagnu commit: <strong>4ea498a8e1fafeb568530d84db1880066478c86b(riscv-dejagnu-1.6)</strong></p><p>riscv-gcc commit: <strong>ca312387ab141060c20c388d83d6fc4b2099af1d(riscv-gcc-10.2.0)</strong></p><p>riscv-gdb commit: <strong>5da071ef0965b8054310d8dde9975037b0467311(fsf-gdb-10.1-with-sim)</strong></p><p>riscv-glibc commit: <strong>9826b03b747b841f5fc6de2054bf1ef3f5c4bdf3</strong> tag: <strong>glibc-2.33</strong></p><p>riscv-newlib commit: <strong>415fdd4279b85eeec9d54775ce13c5c412451e08</strong> tag: <strong>newlib-4.1.0</strong></p><p>\u6E90\u7801\u5F88\u5927 6.5G\u5DE6\u53F3 \u6240\u4EE5\u514B\u9686\u7684\u65F6\u5019\u4F1A\u5F88\u6162 \u53EF\u4EE5\u5148\u514B\u9686\u4E3B\u4ED3\u5E93 \u5206\u5F00\u514B\u9686\u5B50\u4ED3\u5E93</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/riscv/riscv-gnu-toolchain
<span class="token builtin class-name">cd</span> riscv-gnu-toolchain
<span class="token function">git</span> submodule update --init --recursive
</code></pre></div><p>\u767E\u5EA6\u4E91\u4E2D\u4E0B\u8F7D\u6211\u8FD9\u8FB9\u4E0A\u4F20\u597D\u7684 \u53EF\u4EE5\u76F4\u63A5\u4E0B\u8F7D\u89E3\u538B</p><p>\u5730\u5740\uFF1A<a href="https://pan.baidu.com/s/1iDNpV2_UTWk4OwZx0Bv2YA" target="_blank" rel="noopener noreferrer">\u6E90\u7801\u5305</a> \u63D0\u53D6\u7801\uFF1A<code>nmvw</code> \u5305\u540D\uFF1A <code>riscv-gnu-toolchain-src-2022-01-17.tar.gz</code></p><p><strong>\u7F16\u8BD1\u5B89\u88C5</strong></p><p><strong>(\u91CD\u8981)\u6CE8: \u5982\u679C\u4F60\u7684 Mac \u662F arm \u67B6\u6784 M1 \u7CFB\u5217\u7684\u82AF\u7247 \u9700\u8981\u6539\u4E2A\u914D\u7F6E</strong></p><p>\u4FEE\u6539\u5982\u4E0B:</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u8FDB\u5165\u76EE\u5F55</span>
<span class="token builtin class-name">cd</span> riscv-gnu-toolchain
<span class="token comment"># \u6CE8\u9500\u914D\u7F6E</span>
<span class="token comment"># \u7F16\u8F91\u6587\u4EF6 </span>
<span class="token function">vim</span> riscv-gcc/gcc/config.host
<span class="token comment"># \u6CE8\u950096\u884C 97\u884C</span>
<span class="token number">96</span>     <span class="token comment">#out_host_hook_obj=host-darwin.o</span>
<span class="token number">97</span>     <span class="token comment">#host_xmake_file=&quot;\${host_xmake_file} x-darwin&quot;</span>
</code></pre></div><p>\u7F16\u8BD1 \u8017\u65F6\u8F83\u957F \u6162\u6162\u7B49\u5F85\u5427 \u76EE\u6D4B\u89811\u5C0F\u65F6\u5DE6\u53F3</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> riscv-gnu-toolchain
./configure --prefix<span class="token operator">=</span>/opt/riscv-gnu-toolchain --with-cmodel<span class="token operator">=</span>medany --enable-multilib
<span class="token comment"># \u56E0\u4E3A\u5B89\u5230opt\u76EE\u5F55\u4E0B\u6240\u4EE5\u52A0\u4E86sudo \u5982\u679C\u4E0D\u5B89\u88C5\u5728\u8FD9\u4E2A\u76EE\u5F55\u4E0B \u53EF\u4EE5\u4E0D\u4F7F\u7528sudo</span>
<span class="token function">sudo</span> <span class="token function">make</span>
</code></pre></div><p>\u5982\u679C\u5B89\u88C5\u6210\u529F \u5219\u663E\u793A\u5982\u4E0B:</p><p><img src="https://img.liu-yao.com/yaoyaoio/mit-make-gdb-install.png" alt="mit-make-gdb-install"></p><p><strong>\u914D\u7F6E\u73AF\u5883\u53D8\u91CF</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u628A\u4EE5\u4E0B\u5185\u5BB9\u6DFB\u52A0\u5230 ~/.zshrc \u6216\u8005 ~/.bash_profile  \u6216\u8005 /etc/profile</span>
<span class="token comment"># \u56E0\u4E3A\u6211\u4F7F\u7528\u7684\u662Fzsh \u6240\u4EE5\u914D\u7F6E\u5230 ~/.zshrc \u91CC</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">RISCV_HOME</span><span class="token operator">=</span>/opt/riscv-gnu-toolchain
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">\${<span class="token environment constant">PATH</span>}</span><span class="token builtin class-name">:</span><span class="token variable">\${RISCV_HOME}</span>/bin
<span class="token comment"># \u7528 source \u547D\u4EE4 \u8BA9\u73AF\u5883\u53D8\u91CF\u91CD\u65B0\u52A0\u8F7D</span>
<span class="token builtin class-name">source</span> ~/.zshrc 
</code></pre></div><h3 id="_3-\u76F4\u63A5\u4F7F\u7528\u9884\u7F16\u8BD1\u7248\u672C-\u53EF\u9009" tabindex="-1"><a class="header-anchor" href="#_3-\u76F4\u63A5\u4F7F\u7528\u9884\u7F16\u8BD1\u7248\u672C-\u53EF\u9009" aria-hidden="true">#</a> 3. <strong>\u76F4\u63A5\u4F7F\u7528\u9884\u7F16\u8BD1\u7248\u672C</strong>\uFF08\u53EF\u9009\uFF09</h3><p><strong>\u4E0B\u8F7D</strong>:</p><p><strong><code>x86_64(intel)</code></strong></p><p>\u5730\u5740\uFF1A<a href="https://pan.baidu.com/s/1iDNpV2_UTWk4OwZx0Bv2YA" target="_blank" rel="noopener noreferrer">\u6E90\u7801\u5305</a> \u63D0\u53D6\u7801\uFF1A<code>nmvw</code> \u5305\u540D\uFF1A <code>riscv-gnu-toolchain-bin-2020.04.01-x86_64-apple-darwin.tar.gz</code></p><p><strong><code>aarm(m1)</code></strong></p><p>\u5730\u5740\uFF1A<a href="https://pan.baidu.com/s/1iDNpV2_UTWk4OwZx0Bv2YA" target="_blank" rel="noopener noreferrer">\u6E90\u7801\u5305</a> \u63D0\u53D6\u7801\uFF1A<code>nmvw</code> \u5305\u540D\uFF1A <code>riscv-gnu-toolchain-bin-2022.01.18-arm64-apple-darwin.tar.gz</code></p><p><strong>\u89E3\u538B</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code>
<span class="token function">tar</span> xf <span class="token punctuation">{</span>\u4E0A\u9762\u4F60\u4E0B\u8F7D\u7684\u5305\u540D<span class="token punctuation">}</span> -C /opt/
<span class="token function">ls</span> /opt/riscv-gnu-toolchain
drwxr-xr-x  <span class="token number">33</span> root  wheel  <span class="token number">1056</span> Jan <span class="token number">19</span> 09:39 bin
drwxr-xr-x   <span class="token number">3</span> root  wheel    <span class="token number">96</span> Jan <span class="token number">19</span> 09:39 include
drwxr-xr-x   <span class="token number">8</span> root  wheel   <span class="token number">256</span> Jan <span class="token number">19</span> 09:39 lib
drwxr-xr-x   <span class="token number">3</span> root  wheel    <span class="token number">96</span> Jan <span class="token number">18</span> <span class="token number">23</span>:54 libexec
drwxr-xr-x   <span class="token number">5</span> root  wheel   <span class="token number">160</span> Jan <span class="token number">18</span> <span class="token number">23</span>:59 riscv64-unknown-elf
drwxr-xr-x   <span class="token number">7</span> root  wheel   <span class="token number">224</span> Jan <span class="token number">19</span> 09:39 share
</code></pre></div><p><strong>\u914D\u7F6E\u73AF\u5883\u53D8\u91CF</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u628A\u4EE5\u4E0B\u5185\u5BB9\u6DFB\u52A0\u5230 ~/.zshrc \u6216\u8005 ~/.bash_profile  \u6216\u8005 /etc/profile</span>
<span class="token comment"># \u56E0\u4E3A\u6211\u4F7F\u7528\u7684\u662Fzsh \u6240\u4EE5\u914D\u7F6E\u5230 ~/.zshrc \u91CC</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">RISCV_HOME</span><span class="token operator">=</span>/opt/riscv-gnu-toolchain
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">\${<span class="token environment constant">PATH</span>}</span><span class="token builtin class-name">:</span><span class="token variable">\${RISCV_HOME}</span>/bin
<span class="token comment"># \u7528 source \u547D\u4EE4 \u8BA9\u73AF\u5883\u53D8\u91CF\u91CD\u65B0\u52A0\u8F7D</span>
<span class="token builtin class-name">source</span> ~/.zshrc 
</code></pre></div><h3 id="_4-\u9A8C\u8BC1\u662F\u5426\u5B89\u88C5\u6210\u529F" tabindex="-1"><a class="header-anchor" href="#_4-\u9A8C\u8BC1\u662F\u5426\u5B89\u88C5\u6210\u529F" aria-hidden="true">#</a> 4. <strong>\u9A8C\u8BC1\u662F\u5426\u5B89\u88C5\u6210\u529F</strong></h3><div class="language-bash ext-sh"><pre class="language-bash"><code>//\u6267\u884C
riscv64-unknown-elf-gcc -v
// \u5982\u6253\u5370\u4EE5\u4E0B\u5185\u5BB9\u4EE3\u8868\u5B89\u88C5\u6210\u529F
riscv64-unknown-elf-gcc -v
Using built-in specs.
<span class="token assign-left variable">COLLECT_GCC</span><span class="token operator">=</span>riscv64-unknown-elf-gcc
<span class="token assign-left variable">COLLECT_LTO_WRAPPER</span><span class="token operator">=</span>/opt/riscv-gnu-toolchain/libexec/gcc/riscv64-unknown-elf/11.1.0/lto-wrapper
Target: riscv64-unknown-elf
Thread model: single
Supported LTO compression algorithms: zlib
gcc version <span class="token number">11.1</span>.0 <span class="token punctuation">(</span>GCC<span class="token punctuation">)</span>

</code></pre></div><h2 id="\u5B89\u88C5-qemu" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5-qemu" aria-hidden="true">#</a> \u5B89\u88C5 Qemu</h2><p>qemu \u662F\u5F3A\u5927\u7684\u865A\u62DF\u673A\u64CD\u4F5C\u7CFB\u7EDF\u6A21\u62DF\u5668\uFF0C\u5728\u6B64\u8BFE\u7A0B\u4E2D\uFF0C\u6211\u4EEC\u4F7F\u7528 qemu \u6765\u6A21\u62DF\u786C\u4EF6 \uFF0C\u4F7F xv6 \u8FD0\u884C\u5728\u8BE5\u6A21\u62DF\u5668\u4E4B\u4E0A\u3002</p><p>\u6211\u5B89\u88C5\u7684 qemu \u7248\u672C\u4E3A <code>6.2.0</code></p><p>**\u4EE5\u4E0B\u5B89\u88C5\u9009\u4E00\u4E2A\u5373\u53EF \u4F60\u600E\u4E48\u5F00\u5FC3\u600E\u4E48\u9009 \u6211\u7528\u7684\u662F <code>1.\u4F7F\u7528 brew \u5B89\u88C5</code></p><h3 id="_1-\u4F7F\u7528-brew-\u5B89\u88C5-\u53EF\u9009" tabindex="-1"><a class="header-anchor" href="#_1-\u4F7F\u7528-brew-\u5B89\u88C5-\u53EF\u9009" aria-hidden="true">#</a> 1. \u4F7F\u7528 brew \u5B89\u88C5\uFF08\u53EF\u9009\uFF09</h3><div class="language-bash ext-sh"><pre class="language-bash"><code>// \u672C\u4EBA\u5C31\u4F7F\u7528\u4E86\u8FD9\u79CD\u65B9\u5F0F\u8FDB\u884C\u5B89\u88C5
brew <span class="token function">install</span> qemu
</code></pre></div><h3 id="_2-\u4F7F\u7528\u6E90\u7801\u5B89\u88C5-\u53EF\u9009" tabindex="-1"><a class="header-anchor" href="#_2-\u4F7F\u7528\u6E90\u7801\u5B89\u88C5-\u53EF\u9009" aria-hidden="true">#</a> 2. \u4F7F\u7528\u6E90\u7801\u5B89\u88C5\uFF08\u53EF\u9009\uFF09</h3><p><strong>\u4E0B\u8F7D\u6E90\u7801\u5E76\u7F16\u8BD1\u5B89\u88C5</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">wget</span> https://download.qemu.org/qemu-6.2.0.tar.xz
<span class="token function">tar</span> xf qemu-6.2.0.tar.xz
<span class="token builtin class-name">cd</span> qemu-6.2.0
./configure --prefix<span class="token operator">=</span>/opt/qemu
<span class="token function">make</span> 
<span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p><strong>\u914D\u7F6E\u73AF\u5883\u53D8\u91CF</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u628A\u4EE5\u4E0B\u5185\u5BB9\u6DFB\u52A0\u5230 ~/.zshrc \u6216\u8005 ~/.bash_profile  \u6216\u8005 /etc/profile</span>
<span class="token comment"># \u56E0\u4E3A\u6211\u4F7F\u7528\u7684\u662Fzsh \u6240\u4EE5\u914D\u7F6E\u5230 ~/.zshrc \u91CC</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">QEMU_HOME</span><span class="token operator">=</span>/opt/qemu
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">\${<span class="token environment constant">PATH</span>}</span><span class="token builtin class-name">:</span><span class="token variable">\${QEMU_HOME}</span>/bin
<span class="token comment"># \u7528 source \u547D\u4EE4 \u8BA9\u73AF\u5883\u53D8\u91CF\u91CD\u65B0\u52A0\u8F7D</span>
<span class="token builtin class-name">source</span> ~/.zshrc 
</code></pre></div><h3 id="_3-\u9A8C\u8BC1\u662F\u5426\u5B89\u88C5\u6210\u529F" tabindex="-1"><a class="header-anchor" href="#_3-\u9A8C\u8BC1\u662F\u5426\u5B89\u88C5\u6210\u529F" aria-hidden="true">#</a> 3. \u9A8C\u8BC1\u662F\u5426\u5B89\u88C5\u6210\u529F</h3><div class="language-bash ext-sh"><pre class="language-bash"><code>// \u6267\u884C \u5982\u679C\u6253\u5370\u4EE5\u4E0B\u5185\u5BB9\u4EE3\u8868\u5B89\u88C5\u6210\u529F
qemu-system-riscv64 --version
QEMU emulator version <span class="token number">6.1</span>.0
Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2003</span>-2021 Fabrice Bellard and the QEMU Project developers
</code></pre></div><h2 id="\u7F16\u8BD1\u53CA\u8FD0\u884C-xv6" tabindex="-1"><a class="header-anchor" href="#\u7F16\u8BD1\u53CA\u8FD0\u884C-xv6" aria-hidden="true">#</a> \u7F16\u8BD1\u53CA\u8FD0\u884C xv6</h2><p><strong>\u514B\u9686</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/mit-pdos/xv6-riscv.git
</code></pre></div><p><strong>\u7F16\u8BD1</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> xv6-riscv
<span class="token function">make</span>

</code></pre></div><p><strong>\u4F7F\u7528 qemu \u8FD0\u884C</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">make</span> qemu
</code></pre></div><p>\u663E\u793A\u5982\u4E0B\u4EE3\u8868\u8FD0\u884C\u6210\u529F</p><p><img src="https://img.liu-yao.com/yaoyaoio/mit-make-qemu.png" alt="mit-make-qemu"></p><h2 id="\u4F7F\u7528-qemu-gdb-\u5BF9-xv6\u8FDB\u884C\u8C03\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-qemu-gdb-\u5BF9-xv6\u8FDB\u884C\u8C03\u8BD5" aria-hidden="true">#</a> \u4F7F\u7528 qemu-gdb \u5BF9 xv6\u8FDB\u884C\u8C03\u8BD5</h2><p>\u9700\u89812\u4E2A\u7A97\u53E3(\u7EC8\u7AEF)</p><h3 id="\u7A97\u53E31" tabindex="-1"><a class="header-anchor" href="#\u7A97\u53E31" aria-hidden="true">#</a> \u7A97\u53E31</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> xv6-riscv
<span class="token function">make</span> <span class="token assign-left variable">CPUS</span><span class="token operator">=</span><span class="token number">1</span> qemu-gdb
</code></pre></div><p>\u663E\u793A\u5982\u4E0B \u8FD9\u6837\u4EE3\u8868\u542F\u52A8\u6210\u529F qemu-gdb</p><p><img src="https://img.liu-yao.com/yaoyaoio/mit-make-qemu-gdb.png" alt="mit-make-qemu-gdb"></p><h3 id="\u7A97\u53E32" tabindex="-1"><a class="header-anchor" href="#\u7A97\u53E32" aria-hidden="true">#</a> \u7A97\u53E32</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> xv6-riscv
riscv64-unknown-elf-gdb
</code></pre></div><p>\u663E\u793A\u5982\u4E0B \u8FD9\u6837\u4EE3\u8868\u6210\u529F</p><p><img src="https://img.liu-yao.com/yaoyaoio/mit-riscv-gdb.png" alt="mit-riscv-gdb"></p><p>\u6CE8: <code>xv6-riscv</code> \u76EE\u5F55\u4E0B\u6709 <code>.gdbinit</code> \u914D\u7F6E \u6709\u7684\u60C5\u51B5\u4E0B <code>riscv64-unknown-elf-gdb</code> \u4F1A\u81EA\u52A8\u52A0\u8F7D \u5982\u679C\u6CA1\u6709\u81EA\u52A8\u52A0\u8F7D\u5219\u9700\u8981\u4F60\u624B\u52A8 <code>source .gdbinit</code> \u5F53\u6253\u5370 <code>0x0000000000001000 in ?? ()</code> \u4EE3\u8868\u53EF\u4EE5\u8C03\u8BD5\u3002</p><h2 id="faq" tabindex="-1"><a class="header-anchor" href="#faq" aria-hidden="true">#</a> <strong>FAQ</strong>:</h2><ol><li><p>ld: symbol(s) not found for architecture arm64</p><p>\u5982\u679C\u51FA\u73B0\u6B64\u95EE\u9898 \u4E00\u822C\u90FD\u662F arm\u67B6\u6784 \u5BFC\u81F4\u7684</p><p><strong>\u5B98\u65B9 issues \u53CD\u9988\u7684\u95EE\u9898\uFF1A<a href="https://github.com/riscv-software-src/homebrew-riscv/issues/47" target="_blank" rel="noopener noreferrer">https://github.com/riscv-software-src/homebrew-riscv/issues/47</a></strong></p><p>\u89E3\u51B3\u529E\u6CD5:</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u8FDB\u5165\u76EE\u5F55</span>
<span class="token builtin class-name">cd</span> riscv-gnu-toolchain
<span class="token comment"># \u6CE8\u9500\u914D\u7F6E</span>
<span class="token comment"># \u7F16\u8F91\u6587\u4EF6 </span>
<span class="token function">vim</span> riscv-gcc/gcc/config.host
<span class="token comment"># \u6CE8\u950096\u884C 97\u884C</span>
<span class="token number">96</span>     <span class="token comment">#out_host_hook_obj=host-darwin.o</span>
<span class="token number">97</span>     <span class="token comment">#host_xmake_file=&quot;\${host_xmake_file} x-darwin&quot;</span>
</code></pre></div></li><li><p>\u5982\u679C\u51FA\u73B0\u6B64\u95EE\u9898 \u662Fgdb\u6CA1\u6709\u6B63\u5E38\u52A0\u8F7D</p><div class="language-bash ext-sh"><pre class="language-bash"><code>Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2020</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="token number">3</span> or later <span class="token operator">&lt;</span>http://gnu.org/licenses/gpl.html<span class="token operator">&gt;</span>
This is <span class="token function">free</span> software: you are <span class="token function">free</span> to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type <span class="token string">&quot;show copying&quot;</span> and <span class="token string">&quot;show warranty&quot;</span> <span class="token keyword">for</span> details.
This GDB was configured as <span class="token string">&quot;--host=arm-apple-darwin21.2.0 --target=riscv64-unknown-elf&quot;</span><span class="token builtin class-name">.</span>
Type <span class="token string">&quot;show configuration&quot;</span> <span class="token keyword">for</span> configuration details.
For bug reporting instructions, please see:
<span class="token operator">&lt;</span>https://www.gnu.org/software/gdb/bugs/<span class="token operator">&gt;</span>.
Find the GDB manual and other documentation resources online at:
    <span class="token operator">&lt;</span>http://www.gnu.org/software/gdb/documentation/<span class="token operator">&gt;</span>.

For help, <span class="token builtin class-name">type</span> <span class="token string">&quot;help&quot;</span><span class="token builtin class-name">.</span>
Type <span class="token string">&quot;apropos word&quot;</span> to search <span class="token keyword">for</span> commands related to <span class="token string">&quot;word&quot;</span><span class="token builtin class-name">.</span>
warning: File <span class="token string">&quot;/.../xv6-riscv/.gdbinit&quot;</span> auto-loading has been declined by your \`auto-load safe-path&#39; <span class="token builtin class-name">set</span> to <span class="token string">&quot;<span class="token variable">$debugdir</span>:<span class="token variable">$datadir</span>/auto-load&quot;</span><span class="token builtin class-name">.</span>
To <span class="token builtin class-name">enable</span> execution of this <span class="token function">file</span> <span class="token function">add</span>
	add-auto-load-safe-path /<span class="token punctuation">..</span>./Documents/code/os/xv6-riscv/.gdbinit
line to your configuration <span class="token function">file</span> <span class="token string">&quot;/Users/.../.gdbinit&quot;</span><span class="token builtin class-name">.</span>
To completely disable this security protection <span class="token function">add</span>
	<span class="token builtin class-name">set</span> auto-load safe-path /
line to your configuration <span class="token function">file</span> <span class="token string">&quot;/Users/.../.gdbinit&quot;</span><span class="token builtin class-name">.</span>
For <span class="token function">more</span> information about this security protection see the
<span class="token string">&quot;Auto-loading safe path&quot;</span> section <span class="token keyword">in</span> the GDB manual.  E.g., run from the shell:
	info <span class="token string">&quot;(gdb)Auto-loading safe path&quot;</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span>
</code></pre></div><p>\u89E3\u51B3\u529E\u6CD5:</p><p><code>xv6-riscv</code> \u76EE\u5F55\u4E0B\u6709 <code>.gdbinit</code> \u914D\u7F6E \u6709\u7684\u60C5\u51B5\u4E0B <code>riscv64-unknown-elf-gdb</code> \u4F1A\u81EA\u52A8\u52A0\u8F7D \u5982\u679C\u6CA1\u6709\u81EA\u52A8\u52A0\u8F7D\u5219\u9700\u8981\u4F60\u624B\u52A8 <code>source .gdbinit</code> \u5F53\u6253\u5370 <code>0x0000000000001000 in ?? ()</code> \u4EE3\u8868\u53EF\u4EE5\u8C03\u8BD5\u3002</p></li></ol><h2 id="\u53C2\u8003\u8D44\u6599" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u8D44\u6599" aria-hidden="true">#</a> \u53C2\u8003\u8D44\u6599:</h2><ol><li><a href="https://rcore-os.github.io/rCore-Tutorial-Book-v3/chapter0/5setup-devel-env.html#qemu" target="_blank" rel="noopener noreferrer">https://rcore-os.github.io/rCore-Tutorial-Book-v3/chapter0/5setup-devel-env.html#qemu</a></li><li>https://github.com/riscv-software-src/homebrew-riscv</li><li>https://github.com/riscv-software-src/homebrew-riscv/issues/47</li><li>https://github.com/riscv-collab/riscv-gnu-toolchain</li><li><a href="https://zhayujie.com/mit6828-env.html" target="_blank" rel="noopener noreferrer">https://zhayujie.com/mit6828-env.html</a></li></ol>`,97);function o(t,c){return e}var r=s(a,[["render",o],["__file","mit6s081-install-riscv-qemu-xv6.html.vue"]]);export{r as default};
